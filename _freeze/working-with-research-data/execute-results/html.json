{
  "hash": "b6e501b1dfc31240ea7db65e1da22972",
  "result": {
    "markdown": "---\ntitle: \"From practice data to research data\"\n---\n\n\n\n\nSome Institute participants have encountered problems when transitioning from practice data (in the tutorials) to the research data. Here we share some common problems and their solutions. \n\n## Preface\n\nThere are currently two points of access to MIDFIELD data:\n\n[MIDFIELD](https://midfield.online/). &nbsp; A database of anonymized student-level records for approximately 2.4M undergraduates at 21 US institutions from 1987--2022. Access to this database requires a confidentiality agreement and Institutional Review Board (IRB) approval for human subjects research. \n\n[midfielddata](https://midfieldr.github.io/midfielddata/). &nbsp; An R data package that supplies anonymized student-level records for 98,000 undergraduates at three US institutions from 1988-2018. A sample of the MIDFIELD database, midfielddata provides practice data for the tools and methods in the midfieldr package. \n\nCompared to the practice data, the research data contains additional variables (columns). The similarities and differences can be found by comparing the two data dictionaries. \n\n\nData dictionaries \n\n- student table [practice data](https://midfieldr.github.io/midfielddata/reference/student.html) /  [research data](resources/research-variables-student.pdf)\n- term table [practice data](https://midfieldr.github.io/midfielddata/reference/term.html) /  [research data](resources/research-variables-term.pdf)\n- course table [practice data](https://midfieldr.github.io/midfielddata/reference/course.html) /  [research data](resources/research-variables-course.pdf)\n- degree table [practice data](https://midfieldr.github.io/midfielddata/reference/degree.html) /  [research data](resources/research-variables-degree.pdf)\n\n\n## Getting started\n\nWe assume you are working in an RStudio project with a project directory (folder) that looks something like this: \n\n    midfield_project_name\\\n        data\\\n        exercises\\\n        R\\\n        midfield_project_nname.Rproj\n\nYour research data files should be located in the `data` directory. We suggest separate directories for practice scripts or exercises (like this tutorial) and mature scripts (in an `R` or `scripts` directory) that document your MIDFIELD research study. \n\nIf you are writing your own script to follow along, we use these packages in this article:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# packages\nlibrary(midfieldr)\nsuppressPackageStartupMessages(library(data.table))\n```\n:::\n\n\nTo illustrate the problems and solutions, we use the `toy_*` data sets included with midfieldr. To practice working with a local CSV file, we write the `toy_term` data set to the `data` directory. This code chunk writes the data to file only if the CSV file does not already exist. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# write a CSV file (once)\nif(!file.exists(\"data/toy_term.csv\")){\n  write.csv(toy_term, \"data/toy_term.csv\", row.names = FALSE)\n}\n```\n:::\n\n\nIn the code chunks below, we use `df` to indicate a base R data.frame object and `dt` to indicate a data frame that is also a data.table object. \n\n\n\n\n## Column classes\n\n[Problem.]{.important} &nbsp; A data-import function might interpret the CIP or term variables as integers instead of the expected character strings. \n\nTo illustrate the problem, let's read the `toy_term` CSV file and view its structure. Note that the `cip6` and `term` variables are imported as integers. The problem is that the leading zero that starts some CIPs will be lost. midfieldr functions expect `term` and `cip6` to be imported as character variables. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# import in base R\ndf <- read.csv(\"data/toy_term.csv\")\n\n# view \nstr(df)\n#> 'data.frame':\t150 obs. of  5 variables:\n#>  $ mcid       : chr  \"MID25920101\" \"MID26338020\" \"MID25861547\" \"MID26580980\" ...\n#>  $ institution: chr  \"Institution B\" \"Institution K\" \"Institution B\" \"Institution J\" ...\n#>  $ term       : int  20043 19934 20063 20045 20121 20143 19984 19994 20031 19881 ...\n#>  $ cip6       : int  270101 90701 420101 30103 190504 450701 131317 521401 999999 520801 ...\n#>  $ level      : chr  \"03 Junior\" \"03 Junior\" \"02 Sophomore\" \"04 Senior\" ...\n```\n:::\n\n\nImporting with data.table's `fread()` yields a similar result. \n\n[Base R solution.]{.important}  &nbsp; Use the `colClasses` argument to explicitly classify selected variables. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read.csv(\"data/toy_term.csv\", \n               colClasses = c(cip6 = \"character\", term = \"character\"))\nstr(df)\n#> 'data.frame':\t150 obs. of  5 variables:\n#>  $ mcid       : chr  \"MID25920101\" \"MID26338020\" \"MID25861547\" \"MID26580980\" ...\n#>  $ institution: chr  \"Institution B\" \"Institution K\" \"Institution B\" \"Institution J\" ...\n#>  $ term       : chr  \"20043\" \"19934\" \"20063\" \"20045\" ...\n#>  $ cip6       : chr  \"270101\" \"090701\" \"420101\" \"030103\" ...\n#>  $ level      : chr  \"03 Junior\" \"03 Junior\" \"02 Sophomore\" \"04 Senior\" ...\n```\n:::\n\n\n[data.table solution.]{.important}  &nbsp; `fread()` has a `colClasses` argument too.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt <- fread(\"data/toy_term.csv\", \n            colClasses = c(cip6 = \"character\", term = \"character\"))\nstr(dt)\n#> Classes 'data.table' and 'data.frame':\t150 obs. of  5 variables:\n#>  $ mcid       : chr  \"MID25920101\" \"MID26338020\" \"MID25861547\" \"MID26580980\" ...\n#>  $ institution: chr  \"Institution B\" \"Institution K\" \"Institution B\" \"Institution J\" ...\n#>  $ term       : chr  \"20043\" \"19934\" \"20063\" \"20045\" ...\n#>  $ cip6       : chr  \"270101\" \"090701\" \"420101\" \"030103\" ...\n#>  $ level      : chr  \"03 Junior\" \"03 Junior\" \"02 Sophomore\" \"04 Senior\" ...\n#>  - attr(*, \".internal.selfref\")=<externalptr>\n```\n:::\n\n\n\n\n\n\n\n## Filtering rows\n\n[Problem.]{.important}  &nbsp; The tutorial examples for filtering by rows doesn't work if a data frame is not also a data.table object. \n\nTo illustrate, let's use the `df` data frame we created earlier, \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# the data.frame object from earlier\nstr(df)\n#> 'data.frame':\t150 obs. of  5 variables:\n#>  $ mcid       : chr  \"MID25920101\" \"MID26338020\" \"MID25861547\" \"MID26580980\" ...\n#>  $ institution: chr  \"Institution B\" \"Institution K\" \"Institution B\" \"Institution J\" ...\n#>  $ term       : chr  \"20043\" \"19934\" \"20063\" \"20045\" ...\n#>  $ cip6       : chr  \"270101\" \"090701\" \"420101\" \"030103\" ...\n#>  $ level      : chr  \"03 Junior\" \"03 Junior\" \"02 Sophomore\" \"04 Senior\" ...\n```\n:::\n\n\nUsing the code from the Institute tutorials to filter by institution yields an error,\n\n```r\nx <- df[institution == \"Institution B\"]\n#> Error: object 'institution' not found\n```\n\n[Base R solution.]{.important}  &nbsp; Base R syntax requires `df$institution` in the row operation inside the brackets, plus a comma to separate row from column operations. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# base R filter by row\nx <- df[df$institution == \"Institution B\", , drop = FALSE]\n\n# view \nstr(x)\n#> 'data.frame':\t14 obs. of  5 variables:\n#>  $ mcid       : chr  \"MID25920101\" \"MID25861547\" \"MID25898914\" \"MID25934290\" ...\n#>  $ institution: chr  \"Institution B\" \"Institution B\" \"Institution B\" \"Institution B\" ...\n#>  $ term       : chr  \"20043\" \"20063\" \"19903\" \"19991\" ...\n#>  $ cip6       : chr  \"270101\" \"420101\" \"260101\" \"520201\" ...\n#>  $ level      : chr  \"03 Junior\" \"02 Sophomore\" \"01 Freshman\" \"03 Junior\" ...\n```\n:::\n\n\nIn base R, it is also good practice to add a third argument `drop = FALSE` to get around the default behavior that, if a result is a single column, converts the data frame to a vector. \n\nAlternatively, we can identify the rows we want to keep in a separate line, \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# row-selection criterion\nrows_we_want <- df$institution == \"Institution B\"\n\n# base R filter by row\ny <- df[rows_we_want, , drop = FALSE]\n```\n:::\n\n\nConfirm that results are the same (using `midfieldr::same_content()`)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# verify results\nsame_content(x, y)\n#> [1] TRUE\n```\n:::\n\n\n\n\n[data.table solution.]{.important}  &nbsp; Create a data.table using one of two methods. \n\nWe created a data.table by importing the data using `fread()`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# the data.table object from earlier\nstr(dt)\n#> Classes 'data.table' and 'data.frame':\t150 obs. of  5 variables:\n#>  $ mcid       : chr  \"MID25920101\" \"MID26338020\" \"MID25861547\" \"MID26580980\" ...\n#>  $ institution: chr  \"Institution B\" \"Institution K\" \"Institution B\" \"Institution J\" ...\n#>  $ term       : chr  \"20043\" \"19934\" \"20063\" \"20045\" ...\n#>  $ cip6       : chr  \"270101\" \"090701\" \"420101\" \"030103\" ...\n#>  $ level      : chr  \"03 Junior\" \"03 Junior\" \"02 Sophomore\" \"04 Senior\" ...\n#>  - attr(*, \".internal.selfref\")=<externalptr>\n```\n:::\n\n\nOr we apply the data.table function `setDT()` to a convert data frame to a data.table object. Note that a data.table is also a data.frame. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data.frame object\nz <- copy(df)\nclass(z)\n#> [1] \"data.frame\"\n\n# convert to data.table\nsetDT(z)\nclass(z)\n#> [1] \"data.table\" \"data.frame\"\n```\n:::\n\n\nThe tutorial-suggested filtering works, \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data.table filter by row\nx <- dt[institution == \"Institution B\"]\n\n# view\nstr(x)\n#> Classes 'data.table' and 'data.frame':\t14 obs. of  5 variables:\n#>  $ mcid       : chr  \"MID25920101\" \"MID25861547\" \"MID25898914\" \"MID25934290\" ...\n#>  $ institution: chr  \"Institution B\" \"Institution B\" \"Institution B\" \"Institution B\" ...\n#>  $ term       : chr  \"20043\" \"20063\" \"19903\" \"19991\" ...\n#>  $ cip6       : chr  \"270101\" \"420101\" \"260101\" \"520201\" ...\n#>  $ level      : chr  \"03 Junior\" \"02 Sophomore\" \"01 Freshman\" \"03 Junior\" ...\n#>  - attr(*, \".internal.selfref\")=<externalptr>\n```\n:::\n\n\nAlternatively, we can identify the rows we want to keep in a separate line, similar to the alternate base R solution (note the `$` notation),  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# row-selection criterion\nrows_we_want <- dt$institution == \"Institution B\"\n\n# data.table filter by row\ny <- dt[rows_we_want]\n\n# verify results\nsame_content(x, y)\n#> [1] TRUE\n```\n:::\n\n\nLastly, because data.table objects are also data.frames, base R syntax works correctly on data.table objects. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# base R syntax with a data.table object\nz <- dt[rows_we_want, , drop = FALSE]\n\n# verify results\nsame_content(x, z)\n#> [1] TRUE\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}